
process to create replica set
db.shutdownServer()
sudo mongod --fork --port 27017 --dbpath /var/lib/mongodb --replSet rs0 --master --logpath /var/log/mongodb/mongodb_replica.log
connect using mongo
rs.initiate()

start nginx server

start application service
supervisord -c localtutor/supervisord_prod.conf

install elastic search
install jdk
set JAVA_HOME path variable
check $ES_HEAP_SIZE - elasticsearch heap size
check swap space on the system and increase if necessary
./bin/elasticsearch -d (for running as a daemon process)
create index mapping settings
mongo-connector -m localhost:27017 -t localhost:9200 -d elastic_doc_manager - this command only from elasticsearch/elasticsearch2.0.0
elasticsearch.in.sh script has settings for jvm heap size etc
set environment variables in /etc/environment

create swap space on vps
https://www.digitalocean.com/community/tutorials/how-to-add-swap-on-ubuntu-14-04

show index settings
curl -XGET 'http://localhost:9200/local_tutor/_settings'

show cluster health
curl -XGET 'http://localhost:9200/_cat/indices?v'

show field mappings
curl -XGET 'http://localhost:9200/local_tutor/_mapping/teachers'

delete index
curl -XDELETE 'http://localhost:9200/_all'

create index mappings
curl -XPOST 'http://localhost:9200/local_tutor' -d @elasticsearch_index_settings.txt

mongo backup
mongodump --out mongo_backup_<date>

copy from remote host to local machine
scp -r uday@104.131.180.232:/home/uday/mongo_backup_<date> ./

mongo restore - from inside the backup directory
mongorestore --drop local_tutor/

create multifield mapping

 {
    "teachers": {
      "properties": {
        
        "resource_type": {
          "type": "multi_field",
          "fields": {
          "resource_type":{"type":"string"},
          "not_analyzed": {"type":"string","index":"not_analyzed"}
        }}
      }
    }
  }