{% extends "base2.html" %}
{% block css %}
<link rel="stylesheet" href="/static/stylesheets/pages/page_search_inner.css">
{% endblock %}

{% block content %}

<!--div class="breadcrumbs breadcrumbs-dark">
        <div class="container">
            <h1 class="pull-left">Search Results</h1>
           
        </div>
    </div-->
    <div class="container">
  <div class="search-block-v2">
        <div class="container" style="margin-top:-30px;margin-bottom:-20px;">
            <div class="col-md-6 ">
               <h3>Search results for {{query}}</h3>
                <div class="input-group">

                    <input id="search" type="text" class="form-control" placeholder="{{query}}" value="{{query}}" onkeydown="if (event.keyCode==13) { search();}" value="{{query}}">
                    <span class="input-group-btn">
                        <button class="btn-u" type="button" style="margin-top:-0.4em;" onclick="search()"><i class="fa fa-search"></i></button>
                    </span>
                </div>
                {% if current_user.id %}
                <h5 id="question_satisfy" class="note" style="display:inline;"> Found the search results satisfactory? 

                </h5> 
                <button id="yes_satisfy" class="btn btn-u btn-xs" type="button" onclick="result_satisfaction('yes')">Yes</button>
                  <button id="no_satisfy" class="btn btn-u btn-xs" type="button"  onclick="result_satisfaction('no')">No</button>
                  <div id="message_satisfy" style="display:none;color:#999;">Great, thanks for the feedback! </div>
                  <div id="message_satisfy_no" style="display:none;color:#999;">Thanks for the feedback - we'll definitely improve the results and appreciate your help. <br>You can also comment on what exactly went wrong.</div>
                  <input id="satisfy_comment" type="text" class="form-control col-md-2" placeholder="eg. irrelevant results" style="display:none;">
                  <span class="input-group-btn" >
                  <button id="satisfy_comment_button" type="button" class="btn btn-u btn-xs" onclick="satisfaction_comment()" style="display:none;margin-top:0.5em;">Submit</button>
                </span>
                  <input type="text" id="satisfy_id" style="display:none;">
                  <div id="satisfy_comment_status" style="display:none;color:#999;">Comment submitted successfully, thank you</div>

                {% endif %}
                 
            </div>
        </div>
    </div>
  </div>
      <!-- Jumbotron -->
        <!--div class="row">
      <div class="col-lg-8 col-md-8 ">
      
      <div class="input-group input-group-md">
  
  <input id="search" type="text" class="form-control col-lg-12 col-md-12" placeholder="{{query}}" aria-describedby="sizing-addon1"
  >
   <span class="input-group-btn">
        <button class="btn btn-primary" type="button" onclick="search()" style="position:relative;top:-2px;">Search</button>
      </span>
</div>
          
        </div>
      </div-->

      <!--div class="row">
      <div class="col-lg-12 col-md-12">
        <h2>Search results for {{query}}</h2>
      </div>
    </div-->
    <div style="display:none;">
      {{current_user.id}}
    </div>

    <div class="container s-results margin-bottom-50">
        <div class="row">
          <button type="button" class="btn-u visible-sm visible-xs" data-toggle="collapse" data-target="#filter-options" style="margin-left:1em;margin-bottom:0.5em;" onclick="toggler()">
            <i class="fa fa-sliders"> Filters </i>
          </button>
            <div id="filter-options" class="col-md-2 related-search hidden-xs hidden-sm">
                <div class="row" style="margin-left:0.1em";>
                   <div style="display:none;">
            <form id='filter_form' type="hidden" action='/search?subject={{query}}' method='POST'>
            </form>
          </div>

          {% if filter_results %}

            {% if venue|length > 0 %}
           
              <div id="venue_outer" class="col-md-12 col-sm-4 sky-form" style="border:0px;max-height:300px;overflow-y:scroll;margin-bottom:30px;">
                 <h3>Filter by Venue</h3>
                
                <ul class="list-unstyled" >
                  
              {% for v in venue %}

              <li><label class="checkbox"><input class="venue_checkbox" type="checkbox" onclick="get_filtered_results_pre('venue')" name="{{v[0]}}"
              {% if v[1] %}
              checked
              {% endif %}
              ><i></i>{{v[0]}}</label></li>
              {% endfor %}
              {% if areas|length>0 and areas[0][0]=='online' %}
              <li><label class="checkbox"><input class="area_checkbox" type="checkbox" onclick="get_filtered_results_pre('venue')" name="online"
              {% if areas[0][1] %}
              checked
              {% endif %}
              ><i></i>Online</label></li>
              {% endif %}
           
            </ul>

            </div>
            {% endif %}

            {% if areas|length > 0 %}
           
              <div id="area_outer" class="col-md-12 col-sm-4 sky-form" style="border:0px;max-height:300px;overflow-y:scroll;margin-bottom:30px;">
                 <h3 >Filter by Area</h3>
                <ul class="list-unstyled" >
                  
              {% for area in areas %}
              {% if area[0]!='online' %}
              <li><label class="checkbox"><input class="area_checkbox" type="checkbox" onclick="get_filtered_results_pre('area')" name="{{area[0]}}"
              {% if area[1] %}
              checked
              {% endif %}
              ><i></i>{{area[0].title()}}</label></li>
              {% endif %}
              {% endfor %}
           
            </ul>

            </div>
            
            {% endif %}
            
            {% if subjects|length > 0 %}
            
            <div id="subject_outer" class="col-md-12 col-sm-4 sky-form" style="border:0px;max-height:300px;overflow-y:scroll;margin-bottom:30px;">
              <h3>Filter by Subject</h3>
              <ul class="list-unstyled">
              {% for subject in subjects %}
              <li><label class="checkbox"><input class="subject_checkbox" type="checkbox" onclick="get_filtered_results_pre('subject')" name="{{subject[0]}}"
              {% if subject[1] %}
              checked
              {% endif %}
              ><i></i>{{subject[0].title()}}</label></li>
              {% endfor %}
            </div>
            {% endif %}

           

                    

                   
                
                {% else %}
                <h3>No Filters</h3>
                {% endif %}
                </div>
            </div><!--/col-md-2-->
            <div class="col-md-10">
                <span class="results-number" style="margin-bottom:30px;">{{total}} results</span>
                <!-- Begin Inner Results -->
                {% for result in results | batch(2) %}
                <div class="inner-results row clearfix">
                  {% for item in result %}
                  <script>
                  buffer["{{item['_id']}}"]=0;
                  </script>

                <div class=" col-lg-6 col-md-6 col-sm-12" style="margin-bottom:20px;">
                  <h3><a class="tutors" href="/tutor?id={{item['_id']}}" id="{{item['_id']}}">{{item['name'].upper()}}</a></h3>
                    
                    <ul class="list-inline up-ul">
                        <li>
                           {% if item['area'] is equalto 'online' %}
                      Available online at <a href="{{item['venue']}}" style="color:#72c02c" >{{item['venue']}}</a>
                      {% else %}

                      {% if item['venue'] is equalto 'both' %}
                      Teaches at both students' home and center
                      
                      {% else %}
                      Teaches at {{item['venue']}}
                      {% endif %}
                      {% endif %}
                        </li>
                        <li class="btn-group">
                            <button data-toggle="dropdown" class="btn btn-default dropdown-toggle" type="button">
                                Subjects Covered<i class="fa fa-caret-down margin-left-5"></i>
                                <span class="sr-only">Toggle Dropdown</span>
                            </button>
                            <ul role="menu" class="dropdown-menu">
                              {% for subject in item['subject'] %}

                                <li><a href="/search?subject={{subject.title()}}&is_pre_filter=y" class="subjects_covered">{{subject.title()}}</a></li>
                                {% endfor %}
                            </ul>
                        </li>
                        
                    </ul>
                    <p>
                      {% if item['area'] is equalto 'online' %}
                     
                      
                      {% else %}
                       <span class="glyphicon glyphicon-phone" aria-hidden="true"></span>
                       {{item['contact_number']|join(',')}}
                       <br>
                       {% endif %}

                        {% if item['area'] is equalto 'online' %}
                       <a href="{{item['geographical_location']}}">Online course link</a>
                       {% else %}
                       {{item['geographical_location'].title()}}
                       {% endif %}
                    </p>
                    
                    <ul id="like_section_{{item['_id']}}" class="list-inline down-ul"
                     {% if item['likes'] > 0 %}
                    style="display:;"
                    {% else %}
                    style="display:none;"
                    {% endif %}
                    >
                      <li>
                         {% if item['likes'] == 0 %}
                    <span id="likes_{{item['_id']}}">
                     
                      </span>
                    {% endif %}

                    {% if item['likes'] > 2 %}
                    <span id="likes_{{item['_id']}}">
                      {% if item['_id'] in student_tutor_like %}
                      You and {{item['likes'] - 1}} people like this teacher 
                      {% else %}
                      {{item['likes']}} people like this teacher 
                      {% endif %}
                      </span>
                    {% endif %}
                    {% if item['likes'] == 2 %}
                    <span id="likes_{{item['_id']}}">
                      {% if item['_id'] in student_tutor_like %}
                      You and {{item['likes'] -1}} person like this teacher 
                      {% else %}
                      {{item['likes']}} people like this teacher 
                      {% endif %}
                      </span>
                    {% endif %}
                    {% if item['likes'] == 1 %}
                    <span id="likes_{{item['_id']}}">
                      {% if item['_id'] in student_tutor_like %}
                      You like this teacher 
                      {% else %}
                      {{item['likes']}} person likes this teacher 
                      {% endif %}
                      </span>
                    {% endif %}

                  </li>
                </ul>
                   

                   
                    {% if current_user.id %}
                    <ul class="list-inline down-ul">
                        <li>
                          {% if current_user.fb_id %}
                   <button id="associate_{{item['_id']}}" type="button" class="btn-u btn-u-sm" onclick="associate_tutor('{{item['_id']}}','{{current_user.fb_id}}')"  
                      {% if item['_id'] not in student_tutor_assoc %}
                      style="display:;"
                      {% else %}
                      style="display:none;"
                      {% endif %}
                      >I studied under this teacher</button>
                      
                      <span id="disassociate_{{item['_id']}}"
                       {% if item['_id'] in student_tutor_assoc %}
                      style="display:;"
                      {% else %}
                      style="display:none;"
                      {% endif %}
                     >
                      

                      
                      You studied under this tutor 

                      <button type="button" class="btn-u btn-u-dark btn-u-sm" onclick="disassociate_tutor('{{item['_id']}}','{{current_user.fb_id}}')">No</button>


                   
                   
                    </span>
                    {% endif %}

                     {% if current_user.id %}
                  <!-- <ul class="list-inline down-ul">
                    <li> -->

                    <button id="like_{{item['_id']}}" type="button" class="btn-u btn-u-sm" onclick="like_tutor('{{item['_id']}}', '{{current_user.id}}',{{item['likes']}})" 
                    {% if item['_id'] not in student_tutor_like %}
                    style="display:;"
                    {% else %}
                    style="display:none;"
                    {% endif %}
                    ><i class="fa fa-thumbs-up"></i> Like</button>

                    <button id="dislike_{{item['_id']}}" type="button" class="btn-u btn-u-sm btn-u-light-green" onclick="dislike_tutor('{{item['_id']}}', '{{current_user.id}}',{{item['likes']}})" 
                    {% if item['_id'] in student_tutor_like %}
                    style="display:;"
                    {% else %}
                    style="display:none;"
                    {% endif %}
                    ><i class="fa fa-thumbs-down"></i> Un-like</button>
            <!--      </li>
                </ul> -->
                  

                    {% endif %}
                     
                    
                     

                    

                        </li>

                        <li>
                    <span  class="label label-default" style="display:none;cursor:pointer;" id="friend_{{item['_id']}}">
                     </span>
                   </li>
                       
                        
                    </ul>
                      {% else %}
                         <ul class="list-inline down-ul">
                        <li>

                        <button type="button" class="btn-u btn-u-sm" data-toggle="modal" data-target="#responsive" ><i class="fa fa-thumbs-up" onclick="track_activity()"></i> Like</button>
                        <div class="modal fade" id="responsive" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                        <h4 class="modal-title" id="myModalLabel4">You need to login to like a tutor</h4>
                                    </div>
                                    <div class="modal-body">
                                        <div class="row">
                                            <div class="col-md-9">
                                            <form class="reg-page" action="/login2" method="post" id="form_login">
                    <div class="reg-header">            
                        <h2>Login to your account</h2>
                        <p>Don't have an account yet? Click <a href="/signup" class="color-green">Sign Up</a> to create a new account.

                        </p>
                    </div>

                    <div class="input-group margin-bottom-20">
                        <span class="input-group-addon"><i class="fa fa-user"></i></span>
                        
                        <input type="text" id="name" class="form-control" name="username" placeholder="Email Id">
                    </div>
                    <div class="input-group margin-bottom-20" style="display:none;">
                        <span class="input-group-addon"><i class="fa fa-user"></i></span>
                        
                        <input type="text" id="redirect_url_login" class="form-control" name="redirect_url" placeholder="redirect_url" value="">
                    </div>                
                    <div class="input-group margin-bottom-20">
                        <span class="input-group-addon"><i class="fa fa-lock"></i></span>
                      
                        <input type="password" id="login_password" class="form-control" name="password" placeholder="Password" onkeydown="if (event.keyCode==19) { document.getElementById('login_submit').focus();}">
                    </div>                    

                    <div class="row">
                        <!--div class="col-md-6" style="padding-left:30px;">
                          <label class="checkbox">
                          <input name="remember_me" id="remember_me" type="checkbox">
                          Stay signed in
                          </label>                                                 
                        </div-->
                        <div class="col-md-6">
                            <button class="btn-u pull-left" type="submit">Login</button>                        
                        </div>
                    </div>
                     </form>
                    <hr>
                    <h4> Or Login through your existing Facebook account</h4>
                    <p> Logging in through Facebook enables you to see what courses your friends are taking.</p>
                    <button class="btn-u pull-left" onclick="fblogin()" data-dismiss="modal" aria-hidden="true" style="background:#3b5998;color:white;">Facebook Login</button><br>
                    <hr>
                    <h4>Forgot your password ?</h4>
                    <p>no worries, <a class="color-green" href="/forgot-password">click here</a> to reset your password.</p>
               
                                            </div>
                                          
                                        </div>
                                    </div>
                                   
                                </div>
                            </div>
                        </div>

                          </li>

                        <li>
                    <span  class="label label-default" style="display:none;cursor:pointer;" id="friend_{{item['_id']}}">
                     </span>
                   </li>
                       
                        
                    </ul>
                    {% endif %}


                </div>
                {% endfor %}
              </div>
                <hr>
                {% endfor %}
                <!-- Begin Inner Results -->

                

                <!-- Begin Inner Results -->
                
                <!-- Begin Inner Results -->

                <div class="margin-bottom-30"></div>

                <div class="text-left" id="page_selection">
                    
                </div>

                <div class="margin-bottom-30">
                  {% if results|length < 4 %}
                  <br><br><br><br><br><br><br><br>
                  {% endif %}
                </div>

            </div><!--/col-md-10-->
 
          </div>
        </div>
   <div class="row">
      
      <div class="col-md-10">
        
   

              <div class="row">
                <div class="col-md-5">
                  <div id="total_pages" style="display:none;">
                    {{total_pages}}
                  </div>
                  <div id="pagination_query" style="display:none">
                    {{query}}
                  </div>
                  <div id="classify" style="display:none" value="{{classify}}">
                    {{classify}}
                  </div>
                  <div id="page" style="display:none" value="{{page}}">
                    {{page}}
                  </div>
                  <div id="page_selection1">
                  </div>
              </div>  
            </div>
          </div>
        </div>

    
      

      <!-- Example row of columns -->
{% endblock %}

{% block javascript %}

<script>
function track_activity(){
  mixpanel.track('Logged-out Like');
}
function result_satisfaction(satisfy){

  if(satisfy=='yes'){

    $('#yes_satisfy').css('display','none');
    $('#no_satisfy').css('display','none');
    $('#question_satisfy').css('display','none');
    $('#message_satisfy').css('display','');
    data={}
    data['_id']='{{current_user.id}}';
    data['satisfy']='yes';
    data['query']='{{query}}';

    jQuery.ajax({
    url: '/result_satisfaction',
    data: data,
    type: 'POST',
    success: function(data)
    {
    }
  });
   

  }
  if(satisfy=='no'){
    $('#yes_satisfy').css('display','none');
    $('#no_satisfy').css('display','none');
    $('#question_satisfy').css('display','none');
    $('#message_satisfy_no').css('display','');
    data={}
    data['_id']='{{current_user.id}}';
    data['satisfy']='no';
    data['query']='{{query}}';

    jQuery.ajax({
    url: '/result_satisfaction',
    data: data,
    type: 'POST',
    success: function(data)
    {
       $('#satisfy_comment').css('display','');
       $('#satisfy_comment_button').css('display','');
       $('#satisfy_id').val(data['satisfy_id']);
    }
  });
  }


}

function satisfaction_comment(){

  var data={}
  data['satisfy_id']=$('#satisfy_id').val();
  data['comment']=$('#satisfy_comment').val();
  jQuery.ajax({
    url: '/result_satisfaction_comment',
    data: data,
    type: 'POST',
    success: function(data)
    {
       $('#satisfy_comment').css('display','none');
       $('#satisfy_comment_button').css('display','none');
       $('#satisfy_comment_status').css('display','');
       
    }
  });

}

$('#form_login').submit(function(){

      
      var name=$('#name').val();
  var password=$('#login_password').val();
  if(name==null || name.trim()=="" || password==null || password.trim()=="")
  {
    alert("Email/Password cannot be empty");
    return false;
  }
  mixpanel.track('Login from Like');

  $('#redirect_url_login').val(window.location);  
    });




$('.result').hover(function(){
  $(this).css('background-color','#eee');
},function(){
  $(this).css('background-color','white');
});
</script>   

<script>     
function options(subject)
{
  return ['check'];
  $.ajax({
  type: "GET",
  url: "/options?subject="+subject,
  
  
  success: function(data)
  {
    return data;
    
  },
  fail: function()
  {
    
    
  }
}).done(function( msg ) {
 // document.getElementById("user_tips").value="";
  //alert("Thanks for helping us improve!");
});
}

var subjects = new Bloodhound({
  datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
  queryTokenizer: Bloodhound.tokenizers.whitespace,
  
  remote: {
    url: '/options?subject=%QUERY',
    wildcard: '%QUERY'
  },
   prefetch : {
    url: '/options?subject='
   
  }
});

var suggestion="";
var classify="y";

$('.input-group #search').typeahead({
  hint: true,
  highlight: true,
  minLength: 1
}, {
  name: 'subjects',
  display: 'value',
  source: subjects
}).on('typeahead:select', function (obj, suggestion) {
  suggestion=suggestion['value'];
  classify="n";
  mixpanel.track('Search Performed',{'Query':suggestion,'From':'Suggestion'});
  window.location='search?is_pre_filter=y&subject='+encodeURIComponent(suggestion); 
  
});




function like_tutor(tutor_id,student_id,likes){

  data={};
  data['tutor_id']=tutor_id;
  data['student_id']=student_id;

  mixpanel.track('Logged-in Like');

  likes=parseInt(likes);
  jQuery.ajax({
    url: '/like_student_tutor',
    data: data,
    type: 'POST',
    success: function(data)
    {
      if(data['result']=='success')
      {
        $('#like_'+tutor_id).css('display','none');
        $('#dislike_'+tutor_id).css('display','');
        if(likes+buffer[""+tutor_id]==0)
        {
          $('#like_section_'+tutor_id).css('display','');
          $('#likes_'+tutor_id).html('You like this teacher');
        }
        if(likes+buffer[""+tutor_id]==1)
        {
          $('#like_section_'+tutor_id).css('display','');
          $('#likes_'+tutor_id).html('You and '+'1 person like this teacher');
        }
        if(likes+buffer[""+tutor_id]>1)
        {
          $('#like_section_'+tutor_id).css('display','');
          $('#likes_'+tutor_id).html('You and '+(likes+buffer[""+tutor_id])+' people like this teacher');
        }
        buffer[""+tutor_id]=buffer[""+tutor_id]+1;

      }
    }

});
}

function dislike_tutor(tutor_id,student_id,likes){

  data={};
  data['tutor_id']=tutor_id;
  data['student_id']=student_id;
  likes=parseInt(likes);

  mixpanel.track('Logged-in Dislike');

  jQuery.ajax({
    url: '/dislike_student_tutor',
    data: data,
    type: 'POST',
    success: function(data)
    {
      if(data['result']=='success')
      {
        $('#dislike_'+tutor_id).css('display','none');
        $('#like_'+tutor_id).css('display','');
      }
      if(likes+buffer[""+tutor_id]<=1)
        {
          $('#like_section_'+tutor_id).css('display','none');
          
        }
      if(likes+buffer[""+tutor_id]==2)
        {
          $('#like_section_'+tutor_id).css('display','');
          $('#likes_'+tutor_id).html('1 person likes this teacher');
        }
      if(likes+buffer[""+tutor_id]>2)
        {
          $('#like_section_'+tutor_id).css('display','');
          if(buffer[""+tutor_id]>0)
          {
          
          $('#likes_'+tutor_id).html(likes+' people like this teacher');
        }
        else {
         $('#likes_'+tutor_id).html((likes-1)+' people like this teacher'); 
        }

        }
        buffer[""+tutor_id]=buffer[""+tutor_id]-1;
    }

});
}


function associate_tutor(tutor_id,student_id){

  mixpanel.track('I Studied Under');
  data={};
  data['tutor_id']=tutor_id;
  data['student_id']=student_id;
  jQuery.ajax({
    url: '/associate_student_tutor',
    data: data,
    type: 'POST',
    success: function(data)
    {
      if(data['result']=='success')
      {
        $('#associate_'+tutor_id).css('display','none');
        $('#disassociate_'+tutor_id).css('display','');
      }
    }

});
}

function disassociate_tutor(tutor_id,student_id){

  mixpanel.track('I did not Study Under');
  data={};
  data['tutor_id']=tutor_id;
  data['student_id']=student_id;
  jQuery.ajax({
    url: '/disassociate_student_tutor',
    data: data,
    type: 'POST',
    success: function(data)
    {
      if(data['result']=='success')
      {
        $('#disassociate_'+tutor_id).css('display','none');
        $('#associate_'+tutor_id).css('display','');
      }
    }

});
}

function tutor(id){
  window.location='tutor?id='+id;
}

function search()
    {
        var name=document.getElementById("search");
        if(name==null || name.value.trim()=="")
          return;
        
          mixpanel.track('Search Performed',{'Query':name.value.trim(),'From':'Search Button'});
          window.location='search?subject='+encodeURIComponent(name.value.trim());
        
    }


function custom_logic(login_status)
{
  //alert(login_status);
  utility(login_status);
}

function utility(login_status){

  
  if(login_status!='connected'){
    $('.associations').each(function(){
      $(this).css('display','none');
    });
  }
  else{
    friend_tutor();
  }

}


function friend_tutor()
{
  //alert('friend_tutor');
  var tutors=[]
  console.log($('.tutors').size());
  $('.tutors').each(function(){
    tutors.push($(this).attr('id'));
  });
  var friends=[]
   FB.api('/me/friends', function(response) {
    console.log(response);
    var ind=0;
    for(ind=0;ind<response['data'].length;ind++)
    {
      friends.push(response['data'][ind]['id']);
    }

    data={}
   data['tutors']=tutors;
   data['friends']=friends;
   console.log(data);
   jQuery.ajax({
    url: '/friend_tutor',
    data: data,
    type: 'POST',
    success: function(data)
    {
      if(data['result']=='success')
      {
        var ind=0;
        for(ind=0;ind<data['friend_tutor'].length;ind++)
        {
          $('#friend_'+data['friend_tutor'][ind]).text('Your friend has studied under this tutor');
          $('#friend_'+data['friend_tutor'][ind]).css('display','');
        }
      }
    }

});
  });
   

}


if(parseInt($('#total_pages').html().trim())>1)
{
$('#page_selection').bootpag({
  total: parseInt($('#total_pages').html().trim()),
  page: parseInt($('#page').html().trim()),
  leaps:false,
  maxVisible:5,
  next:'next',
  prev:'prev'
  //href:'/search?subject='+$('#pagination_query').html().trim()+'&classify='+$('#classify').html().trim()+"&page={% raw %}{{number}}{% endraw %}"
}).on("page",function(event,num){

   var url=window.location.href;
   var n=url.indexOf("page");
   if(n==-1){
   url=url+"&page="+num;
 }
 else{
  url=url.substring(0,n)+"&page="+num;
 }
   $('#filter_form').attr('action',url);
   mixpanel.track('Next Page',{'Page':num});
   get_filtered_results();
   //window.location='/search?subject='+$('#pagination_query').html().trim()+'&classify='+$('#classify').html().trim()+"&page="+num;
});
}

var selected_area=[];
var checkboxes_area=[];
var selected_subject=[];
var checkboxes_subject=[];
var selected_venue=[];
var checkboxes_venue=[];
var actual_tagged_subjects="{{actual_tagged_subjects}}";
var actual_tagged_areas="{{actual_tagged_areas}}";





function get_filtered_results(){

  //get list of checkboxes, get list of checkboxes selected
  //send list to backend
  //send post request to backend


  selected_area="";
  $('#area_outer input:checked').each(function() {
    selected_area=selected_area+$(this).attr('name')+"|";
});

  checkboxes_area="";
  $('.area_checkbox').each(function() {
    checkboxes_area=checkboxes_area+$(this).attr('name')+"|";
}); 



  selected_subject="";
  $('#subject_outer input:checked').each(function() {
    selected_subject=selected_subject+$(this).attr('name')+"|";
});

  checkboxes_subject="";
  $('.subject_checkbox').each(function() {
    checkboxes_subject=checkboxes_subject+$(this).attr('name')+"|";
});
selected_venue="";
  $('#venue_outer input:checked').each(function() {
    if($(this).attr('name')=='online'){
      selected_area=selected_area+$(this).attr('name')+"|";   
    }
    else{
    selected_venue=selected_venue+$(this).attr('name')+"|";
  }
});

  checkboxes_venue="";
  $('.venue_checkbox').each(function() {
    checkboxes_venue=checkboxes_venue+$(this).attr('name')+"|";
}); 
 
  data={}
  data['areas_selected']=selected_area;
  data['areas_checkboxes']=checkboxes_area;
  data['subject_selected']=selected_subject;
  data['subject_checkboxes']=checkboxes_subject;
  data['venue_selected']=selected_venue;
  data['venue_checkboxes']=checkboxes_venue;

/*jQuery.ajax({
    url: window.location.href,
    data: data,
    type: 'POST',
    
    success: function(data)
    {
      if(data['result']=='success')
      {
        var ind=0;
        for(ind=0;ind<data['friend_tutor'].length;ind++)
        {
          $('#friend_'+data['friend_tutor'][ind]).text('Your friend has studied under this tutor');
          $('#friend_'+data['friend_tutor'][ind]).css('display','');
        }
      }
    }

});*/

$('#filter_form').submit();

}

function get_filtered_results_pre(type)
{

  var url=window.location.href;
  var n=url.indexOf("page");
   if(n==-1){
  
 }
 else{
  url=url.substring(0,n);
 }
  $('#filter_form').attr('action',url);
  mixpanel.track('Filter',{'Type':type});
  get_filtered_results();
}

$('#filter_form').submit(function(){

  var input1 = $("<input>")
               .attr("type", "hidden")
               .attr("name", "areas_checkboxes").val(checkboxes_area);

  var input2 = $("<input>")
               .attr("type", "hidden")
               .attr("name", "areas_selected").val(selected_area);

  var input3 = $("<input>")
               .attr("type", "hidden")
               .attr("name", "subject_checkboxes").val(checkboxes_subject);

  var input4 = $("<input>")
               .attr("type", "hidden")
               .attr("name", "subject_selected").val(selected_subject);

  var input5 = $("<input>")
               .attr("type", "hidden")
               .attr("name", "venue_checkboxes").val(checkboxes_venue);

  var input6 = $("<input>")
               .attr("type", "hidden")
               .attr("name", "venue_selected").val(selected_venue);

  var input7 = $("<input>")
               .attr("type", "hidden")
               .attr("name", "actual_tagged_subjects").val(actual_tagged_subjects);

  var input8 = $("<input>")
               .attr("type", "hidden")
               .attr("name", "actual_tagged_areas").val(actual_tagged_areas);

  
  $('#filter_form').append(input1);
  $('#filter_form').append(input2);
  $('#filter_form').append(input3);
  $('#filter_form').append(input4);
  $('#filter_form').append(input5);
  $('#filter_form').append(input6);
  $('#filter_form').append(input7);
  $('#filter_form').append(input8);

});

function toggler(){

  if ($('#filter-options').hasClass('hidden-xs')==true)
  {
    $('#filter-options').removeClass('hidden-xs');
    $('#filter-options').removeClass('hidden-sm');
  }
  else{
    $('#filter-options').addClass('hidden-xs'); 
    $('#filter-options').addClass('hidden-sm'); 
  }
}

mixpanel.track_links('.subjects_covered','Subjects Covered Link');
mixpanel.track_links('.tutors','Tutors Link');
mixpanel.track('Search Results Pageview');
</script>  
{% endblock %}



